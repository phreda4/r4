| closegl demo - Bones
| PHREDA 2008
|------------------------------------------
^reda4.txt
^gui.txt
^close2gl.txt

^models3d.txt
^inc/3dlata.inc

#xm 0
#3dcubo 0

:leds
	-1.0 -1.0 2.0 mtrans
	1.0 1.0 1.0 mscalei
	10 ( 1? )( 1-
		10 ( 1? )( 1-
			'dibu2 3dsprite
			0.2 0.0 0.01 mtrans
			) drop
		-2.0 0.2 0.0 mtrans
		) drop
	;


#x 0.0 #y 0.0 #z 0.0
#xv 0.632 #yv 0.943 #zv 0.31

:paredsonora
	mpush
|		0 0 4.0 mtransi
	4.0 3.0 0.0 mscale
	-4.5 -4.5 10.0  mtrans
	10 ( 1? )( 1-
		10 ( 1? )( 1-
			'dibu2 3dsprite
			1.0 0.0 |0.0 
			rand $fff and 
			mtrans
			) drop
		-10.0 1.0 0.0 mtrans
		) drop
	mpop ;

:piso
	mpush
	0.1 0.1 0.0 mscale
	$1ff mrotx
	-9.0 4.0 20.0  mtrans
	10 ( 1? )( 1-
		10 ( 1? )( 1-
			'dibu3 3dsprite
			2.0 0.0 0.0 mtrans
			) drop
		-20.0 0.0 -2.0 mtrans
		) drop
	mpop ;

#bitmaptecho

:techo
	mpush
	0.1 0.1 0.0 mscale
	$1ff mrotx
	-5.0 -5.0 20.0  mtrans
	10 ( 1? )( 1-
		10 ( 1? )( 1-
|			$1ff mrotxi
|			2dup 10 * + bitmaptecho + c@  mrotxi
			2dup 10 * + bitmaptecho + c@ dup 
			0 swap  8 << 0 mtrans
			'dibu5 3dsprite
			0 swap neg 8 << 0 mtrans
			1.0 0.0 0.0 mtrans
			) drop
		-10.0 0.0 -1.0 mtrans
		) drop
	mpop ;

:pared1
	mpush
	0.1 0.1 0.0 mscale
	$1ff mroty
	5.0 -5.0 20.0  mtrans
	10 ( 1? )( 1-
		10 ( 1? )( 1-
			'dibu3 3dsprite
			0.0 1.0 0.0 mtrans
			) drop
		0.0 -10.0 -1.0 mtrans
		) drop
	mpop ;


:pared2
	mpush
	0.1 0.1 0.0 mscale
	$1ff mroty
	-5.0 -5.0 20.0  mtrans
	10 ( 1? )( 1-
		10 ( 1? )( 1-
			'dibu3 3dsprite
			0.0 1.0 0.0 mtrans
			) drop
		0.0 -10.0 -1.0 mtrans
		) drop
	mpop ;

:cubo
	verde
	mpush
	10.0 10.0 10.0 mscalei
	x y z  mtrans
	3dcubo alambroso
	mpop
	;

:newcubo

	x y z  mtrans
	1.0 1.0 0 mscalei
	mpush
	0.0 0.0 0.5 mtrans
	'dibu5 3dsprite
	0.0 0.0 -1.0 mtrans
	'dibu5 3dsprite
	mpop 
	mpush
	$1ff mrotxi
	0.0 0.5 0.0 mtrans
	'dibu5 3dsprite
	0.0 -1.0 0.0 mtrans
	'dibu5 3dsprite
	mpop
	mpush
	$1ff mrotyi
	0.5 0.0 0.0 mtrans
	'dibu5 3dsprite
	-1.0 0.0 0.0 mtrans
	'dibu5 3dsprite
	mpop

	;

:paredu
	mpush
	5.0 5.0 0.0 mscale
	0 0 3.0 mtrans
	'dibu3 3dsprite

	mpop
	;

:alambre
	mpush
	rojo
	-1.0 -1.0 2.0 mtrans
	0 dup dup project3d 2dup op
	2.0 0.0 0.0 mtrans
	0 dup dup project3d line
	0.0 2.0 0.0 mtrans
	0 dup dup project3d line
	-2.0 0.0 0.0 mtrans
	0 dup dup project3d line line
	mpop
	;

:main
	mem 'bitmaptecho !

	0 paper
	.page
	mem 
	dup '3dcubo ! inicubo 'here !
	'exit <esc>
	.show cls scr
		1.0 3dmode

		0 0 10.0 mtransi
|		pared1 pared2
		piso  techo

		alambre
		mem 100 ( 1? )( 1-
			over c@ rand 30 >> + rot c!+ swap ) 2drop


		mpush
	0.5 0.5 0.0 mscalei
|		0 0 4.0 mtransi
		x y z 100.0 +  mtrans
		'dibu4 3dsprite
		mpop

		x xv + dup abs 40.0 <? ( drop 'x ! )( 2drop xv neg 'xv ! )
		y yv + dup abs 40.0 <? ( drop 'y ! )( 2drop yv neg 'yv ! )
		z zv + dup abs 40.0 <? ( drop 'z ! )( 2drop zv neg 'zv ! )

|		xm mrotyi
|		newcubo

		4 'xm +!

		32 font
		 "close2gl" verde print "demo" rojo print
		 blanco cr
		 z y x "x:%f y:%f z:%f" print cr
		 dup "%d" print cr
		0.1 1.0 3.1415 0.002 0.02 0.2 "%f %f %f %f %f %f" print cr
		;

: 33 main "main.txt" run ;