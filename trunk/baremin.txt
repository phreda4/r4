| bare minimun gameplay
| experimental gameplay project
| PHReda - 2009 - http://www.reda4.org
| http://code.google.com/p/reda4/
|-------------------------------------
^reda4.txt
^gui3.txt

|--------   DIBUJOS made by F5
#fondo2 |spr
 $83060C11 $8307FD63 $7A53FD63 $7A520C13 $83060C1A $157E2A7 $35798 $C7E0D0C $74C1ECE
 $8307FAB1 $8305E943 $7A51E943 $7A53FAB3 $8307FABA $FF589307 $FE001568 $13D8D7C $848B2E
 0

#fondo |spr
 $83060C11 $8307FD63 $7A53FD63 $7A520C13 $83060C1A $157E2A7 $35798 $C7E0D0C $74C1ECE
 $8307FAB1 $8305E943 $7A51E943 $7A53FAB3 $8307FABA $FF589307 $FE001568 $13EAE8C $85899E
 $F52FFAE1 $EB1C0B22 $F4800C14 $F95815D2 $FE980C64 $FFD01862 $8DC1524 $F5413E2 $10A00834
 $13F3FFE2 $CE7FA34 $F52FFAEA $31C01E7 $42C1CA8 $342009C $C7D78CE $F717F9D1 $F257FFA2
 $F5A805D4 $F9DC0CE2 $FF5C05D4 $1201022 $6C80E34 $AD40CE2 $CC40674 $F67FEC2 $9FFF7E4
 $4BF1B2 $F717F9D9 $367FC27 $3C80AD8 $192901C $5DAA00E $F873FDB1 $63E482 $793FB64
 $97FEE3 $F873FDBA $FD67FEE7 $FE5FF278 $FFFFFFC $E 0

#avi1  $CC8FC531 $DE9B77B2 $AB6A54 $24C36252 $38D3A7D4 $397852E3 $26C48DB2 $7588DB4 $D1387852
 $AD202814 $A11BED52 $B1278514 $BD734E82 $C9377FB4 $CC8FC53A $176C90A7 $17D76DC8 $A11103C
 $D15E03E $E1980831 $C40453C2 $C440AA74 $CE490D62 $F134B814 $13B86782 $1ED00B74 $E198083A
 $F690B327 $CB004368 $FF4404C $E02100E $13533AD1 $FCBB3C72 $F6AB6D04 $203AFD2 $120BB7D4
 $2617AFD2 $29178184 $242B4652 $13533AD9 $F9FC337 $F3777A8 $120F0FC $FCFCFEE $39845571
 $31BBEE02 $391FA414 $49F7FE62 $39845579 $31BBFB27 $FBFFFCC $10701E $3FB3A741 $45D85223
 $43608372 $3E0C6294 $47EB9533 $41578812 $3FB3A749 $35F049F7 $2E8FB4D8 $5D410FC $441601E
 $3CD3EAA1 $47801203 $4EE7F972 $4927DD84 $3BFC2283 $36A404E2 $3CD3EAA9 $502009D7 $377820D8
 $5D410FC $441601E 0

#avi2  $CC8FC531 $DE9B77B2 $AB6A54 $24C36252 $38D3A7D4 $397852E3 $26C48DB2 $7588DB4 $D1387852
 $AD202814 $A11BED52 $B1278514 $BD734E82 $C9377FB4 $CC8FC53A $176C90A7 $17D76DC8 $A11103C
 $D15E03E $E1980831 $C40453C2 $C440AA74 $CE490D62 $F134B814 $13B86782 $1ED00B74 $E198083A
 $F690B327 $CB004368 $FF4404C $E02100E $13533AD1 $FCBB3C72 $F6AB6D04 $203AFD2 $120BB7D4
 $2617AFD2 $29178184 $242B4652 $13533AD9 $F9FC337 $F3777A8 $120F0FC $FCFCFEE $39845571
 $31BBEE02 $391FA414 $49F7FE62 $39845579 $31BBFB27 $FBFFFCC $10701E $456BB5E1 $3D905E33
 $36F86AC2 $39283B04 $4933BFF3 $4B6389F2 $456BB5E9 $35F049F7 $2E8FB4D8 $5D410FC $441601E
 $3BFFA091 $45184DE3 $4B604CA2 $488C2AB4 $392BD193 $3567AA92 $3BFFA099 $502009D7 $377820D8
 $5D410FC $441601E 0

#salvavidas |spr
 $1579041 $B92B9042 $B9280094 $B92870C2 $15470C4 $498470C2 $49840094 $49879042 $1579049
 $AD09D07 $4AC1AB8 $3848C $FFFBFFE $EF4FD7E1 $F34FED42 $AFF294 $A07EA92 $140FD544
 $EF4FD7EA $8AC2007 $79BFC38 $FFFFFFC $E $B92BED51 $BA8012B3 $AB0A062 $4A300AB4
 $4833DD43 $E088852 $B92BED59 $E83448A7 $AB42028 $FF0300C $FF0004E 0

#nauf1 |spr
 $DBEC8DB1 $DFF01AB3 $C1301003 $AC7B6243 $BA834F93 $C88FD543 $E49FE2A3 $55FDFF3 $1B6BD543
 $28CB4F93 $382B64F3 $25700803 $2AC1D63 $6048DB3 $DBEC8DBA $26187047 $14B82818 $FFFFFFC
 $E $F6AB6FA1 $E7F36FA2 $E7F3AD24 $E7F3EAA2 $F6ABEAA4 $55BEAA2 $55BAD24 $55B6FA2
 $F6AB6FA9 $407F007 $F867B988 $FFFFFFC $E 0

#nauf2 |spr
 $EB489B11 $EDF42013 $C933FD53 $CE8B5CF3 $DFEF6503 $DC97DAA3 $F2A3E803 $1363E553 $236BD2A3
 $1D676FB3 $2CC76503 $3823F2B3 $10B022C3 $15609863 $EB489B1A $397862E7 $20C01568 $FFFFFFC
 $E $FE076A51 $EF4F6A52 $EF4FA7D4 $EF4FE552 $FE07E554 $CB7E552 $CB7A7D4 $CB76A52
 $FE076A59 $B63EAB7 $133B188 $FFFFFFC $E 0

#naufs |spr
 $F5F89DC1 $F9FC2AC3 $E9F44023 $E3F085A3 $D89452E3 $E1EC1AB3 $FEABF2B3 $1F6BF003 $38D01AB3
 $3ED48B03 $30C89DB3 $2C1C4833 $1CB82D73 $20109DC3 $F5F89DCA $200F8A7 $CB07048 $FFFFFFC
 $E $D5F7251 $FEA77252 $FEA7AFD4 $FEA7ED52 $D5FED54 $1C0FED52 $1C0FAFD4 $1C0F7252
 $D5F7259 $FD542817 $C0BAD28 $FFFFFFC $E
0

#dhunde |spr
 $35791 $EDF75792 $EDF79514 $EDF7D292 $3D294 $120FD292 $120F9514 $120F5792 $35799
 $D8FDDF7 $F27B81B8 $1318FFC $39E $D53EE1F1 $ED4FCFE3 $10B7CFE3 $1CBECF43 $28C6D743
 $1A102563 $16B88B03 $1A113B73 $2619DBE3 $120DBE73 $C094623 $154BDD3 $FAA94383 $F351C123
 $DBE9EE93 $E7F140D3 $EAA095B3 $E3F022C3 $C286FCB3 $D53EE1FA $2ADCBD7 $EBF744E8 $39C
 $1318FFE 0

#agua |spr
 $DA94C321 $CA8BB533 $D08F5243 $DFEFCD43 $E69F44E3 $F6AB1F73 $FD57B533 $6AC3023 $160F64F3
 $24C37253 $1A101AB3 $402B9D23 $4383E7F3 $2A1CD333 $160CCDD3 $140C5AE3 $F4A4D333 $F2A41003
 $DFEC1AB3 $E344B873 $DA94C32A $FEAC5837 $55B9A78 $335C8C $6F6D6EE 0

#ayuda |spr
 $A473BD31 $B724A063 $C12C85A3 $BAB42343 $C1840CD3 $CF385D93 $DB404AD3 $C2877A63 $B72B9273
 $BE7FDA93 $B67FED53 $ADCFA523 $A473BD3A $D7247E97 $B27B5798 $60708C $FAFBE $CDE35791
 $E9444023 $A82563 $FE03ED53 $ED4C0553 $E69FCFE3 $EF4FBD33 $EB4B9A73 $E1EFAA83 $DD437503
 $EF4F5793 $E89F24D3 $CDE3579A $1D42AC7 $D9EB2228 $7070AC $FF00E $FE031941 $84C2123
 $1F0423C3 $1F07F113 $126FE003 $133B2C83 $FE03194A $113C4817 $FEF71078 $302C $FFE
 $281031A1 $3B5F4BC3 $5F7793F2 $5773DC24 $4CE851B2 $3C180334 $3E7FD4C3 $49B7EE62 $4C87D4C4
 $50EFACB2 $42BB9BF4 $33AC54E3 $281031AA $2EA87C87 $50172658 $10003C $FC0100E 0

#aleta |spr
 $AF209DB1 $38D10353 $BB2978F3 $C5310603 $AF209DBA $1ABCF5F7 $99155E38 $FFFFFFC $F7F5E
 $D5E500A1 $F0A44832 $D93F8514 $1EBFDAA2 $30210354 $D5E500AA $604A5C7 $DB408058 $171C9CC
 $21E 0

#tiburon  $BC81D931 $CA8B2772 $FE031CC4 $38D32F82 $4381D134 $BC81D93A $2F2154E7 $FB576FA8 $1209FFC
 $26E $D7E8EDF1 $E1EC8B02 $FCAC8B04 $1E148DB2 $28C4EB44 $19654B82 $FE0158E4 $DF414E32
 $D7E8EDF9 $30605D $D890E8A1 $D93C8052 $15485B4 $216885B2 $276CE344 $1B64E5E3 $1B64B323
 $CB0E093 $4ACA063 $FCACD333 $EEA09863 $EF4CE893 $E144BB23 $E144F5F3 $D890E8AA $FAFDFFD
 $D8990B51 $E1496B92 $FEB15E34 $18C15E32 $22C905F4 $1614F8A3 $14BD2613 $AB8FDF3 $76138C3
 $FE090353 $F4AD3B73 $EEA90353 $FAFDFFD $E09BDFF1 $D73FDFF2 $D73C02A4 $D73C2562 $E0982564
 $E9F42562 $E9F402A4 $E9F7DFF2 $E09BDFF9 $FAFDFFD $160FDD41 $E0BDD42 $E080004 $E0822C2
 $160C22C4 $1E1422C2 $1E140004 $1E17DD42 $160FDD49 $FAFDFFD $DD3FE801 $D7E7E802 $D7E40014
 $D7E41822 $DD3C1824 $E2981822 $E2980014 $E29BE802 $DD3FE809 $10003D $1813DD51 $1167DD52
 $1167F804 $116412C2 $181012C4 $1EBC12C2 $1EBFF804 $1EBFDD52 $1813DD59 $2D 0

|------	 x		y	size r 'sprite
#sfondo	 0.0   0.0  9.0 0 'fondo
#savion	-9.0  -3.0  1.2  0 'avi1
#ssalva -9.0  -6.0  1.0  0 'salvavidas
#snaufr	 2.0   3.0  1.5  0 'nauf1
#saleta	-8.0   0.4  0.3  0 'aleta

#efondo 'sfondo 0
#escena 'saleta 'snaufr 'ssalva 'savion 0

#puntaje 0

#soundavion
#soundtibu
#soundgolpe
#soundola
#soundhelp
#soundcae
#soundgrito
#soundfin

:loadsound
	"avion.ogg" SLOAD 'soundavion !
	"tibu.ogg" SLOAD 'soundtibu !
	"golpe.ogg" SLOAD 'soundgolpe !
	"ola.ogg" SLOAD 'soundola !
	"help.ogg" SLOAD 'soundhelp !
	"cae.ogg" SLOAD 'soundcae !
	"grito.ogg" SLOAD 'soundgrito !
	;

|----------- FX 2D
#fx 0
#fx> 0

:inifx
	clear
	0 here dup dup 'fx> ! 'fx ! !
	;

:+fx | 'acc x y vx vy timelife --
	fx> >r r!+ r!+ r!+ r!+ r!+ r!+ r> 'fx> !
	;

:delfx | parn -- parn
	dup 24 - over
	fx> over - 2 >>
	move | de sr cnt
	-24 'fx> +!
	24 -
	;

:drawfx
	fx ( fx> <? )(
		mpush @+ | dirx acc
		exec | adr
		1? ( swap 4 - !+ )( drop delfx )
		mpop
		) drop
	255 alpha ;

:fxvel | dirx -- dirtl
	>r
	r@+ r@+ 0 mtransi
	r@+ r 12 - +!
	r@+ r 12 - +!
	r> ;

:r0.1 | -- r
	rand 0.1 mod ;

|----------  ESCENA 2D
:ini2d
	omode
	0 0 10.0  mtrans ;

:draw2d | adr --
	( @+ 1? )( >r
		mpush
		r@+ r@+ 0 mtransi
		r@+ dup abs 0 mscalei
		r@+ 1? ( mrotzi )( drop )
		r> @ 3dnsprite
		mpop
		) 2drop
	255 alpha ;

|-------------  ayuda
:getxynaufr | -- x y
	'snaufr @+ swap @ swap ;

:acchelp
	fxvel @+ 0? ( ; ) 1-
	dup 2* alpha
	180 over - 0.01 * dup 0 mscalei
	'ayuda 3dnsprite
	;

:+ayuda
	120
	-0.04 0
	getxynaufr swap 1.0 - swap
	'acchelp +fx
	soundhelp SPLAY
	;

|-------------- Naufrago
#velnaufr 0.01
#timenau
#vtibu

:initibu
	-0.3 0.4 8.0 'saleta !+ !+ !
	-0.06 'vtibu !
	;

:naufrago
	velnaufr 'snaufr +!
	blink 1? ( 'nauf1 )( 'nauf2 ) nip
	'snaufr 16 + !
	snaufr
	7.0 >? ( -0.01 'velnaufr ! )
	-3.0 <? ( 0.01 'velnaufr ! )
	drop
	timenau 1-
	$ff nand? ( +ayuda )
	1? ( 'timenau ! ; ) drop
	+ayuda
	velnaufr neg 'velnaufr !
	rand 10 >> $7f and 20 + 'timenau !
	;

:-naufrago
	-8.0 'snaufr !
	0.022 'velnaufr !
	800  'timenau !
	initibu
	;

:-naufrago2
	-9.0 'snaufr !
	0.0 'velnaufr !
	initibu
	;

|-------------  tiburon
:invtibu
	vtibu neg 'vtibu !
	'saleta 8 + dup @
	dup abs 0.2 + swap
	-? ( drop )( drop neg )
	swap !
	0.6 'saleta 4+ +!
	soundtibu SPLAY
	;

:acctibu
    fxvel @+ 1- 0? ( exit ; )
	255 alpha
	'tiburon 3dnsprite
	;

:accexplo | dirx -- dirtl tl
	0.007 over 12 + +!
	fxvel @+ 0? ( ; ) 1-
	dup 2 << alpha
	'agua 3dnsprite
	;

:comio?
	saleta snaufr - abs
	0.5 >? ( drop ; ) drop
	30 ( 1? )( 1-
		50
		r0.1 abs 0.1 + neg r0.1
		getxynaufr
		'accexplo +fx
		) drop
	60
	-0.01 0.0
	getxynaufr
	'acctibu +fx
	soundola SPLAY
	soundgrito SPLAY
	-naufrago2
	;

:aletatibu
	saleta abs
	8.0 >? ( invtibu ) drop
	vtibu 'saleta +!
	'saleta 4+ @ 2.4 >? ( comio? ) drop
	;

|-------------  explosion
:acchunde
	fxvel @+ 0? ( ; ) 1-
	'dhunde 3dnsprite
	;

:+explode
	30 ( 1? )( 1-
		50
		r0.1 abs 0.1 + neg r0.1
		getxynaufr
		'accexplo +fx
		) drop
	50
	0.05 0.0
	getxynaufr
	'acchunde +fx
	1 'puntaje +!
	-naufrago
	soundgolpe SPLAY
	;

|------------- rescatado
:accresc
	fxvel @+ -? ( 0 nip ; ) 0.01 -
	dup dup 0 mscalei
	255 alpha
	'salvavidas 3dnsprite
	'naufs 3dnsprite
	;

:+rescatado
	1.5
    -0.02 0
	'snaufr 4+ @ snaufr
	'accresc +fx
	1 'puntaje +!
	-naufrago
	;

|------------- flotador
:flotador
	dup @ snaufr - abs
	0.3 <? ( drop 20 + 0 +rescatado ; ) drop
	fxvel @+ 0? ( ; ) 1-
    0.7 dup 0 mscalei
	255 alpha
	'salvavidas 3dnsprite
	;

:getxysalva | -- x y
	'ssalva @+ swap @ swap ;

:+flota
	180
	-0.001 0.02
	getxysalva
	'flotador +fx
	;


|-------------- avion
#velavion 0.05
#velxsal
#velysal

:avion
	velavion 'savion +!
	msec %10 and? ( 'avi1 )( 'avi2 ) 'savion 16 + ! drop
	savion
	9.0 <? ( drop ; ) drop
:+avion
	-9.0 'savion !
	rand 0.08 mod abs 0.06 + 'velavion !
	soundavion SPLAY
	;

:testsalva
	ssalva snaufr - abs
	0.6 <? ( +explode )( +flota )
	drop
	-6.0 'ssalva 4+ !
	;

:salvav
	'ssalva >r
	r @ velxsal + r!+	| x
	r @             	| y
	-6.0 =? ( rdrop drop ; )
	3.0 >? ( rdrop drop testsalva ; )
	velysal + r!+
	r @ 0.001 + r!+	| s
	r @ 0.004 - r!+	| r
	rdrop
	0.005 'velysal +!
	;

|----------- tirar salvavidas
:arroja
	'ssalva 4+ @ -6.0 <>? ( drop ; ) drop
	'savion
	'ssalva >r
	@+ r!+	| x
	@ r!+	| y
	0.6 r!+	| s
	0 r> !	| r
	velavion 'velxsal !
	0 'velysal !
	soundcae SPLAY
	;


|-----------  JUEGO
:resetgame
	0 SPLAY
	0 'puntaje !
	-naufrago
	+avion
	;

:main
	inigui
	inifx
	ini2d
	'exit <esc>
	'arroja <esp>
	resetgame
	show clrscr
		'efondo draw2d
		aletatibu
		drawfx
		'escena draw2d
		avion
		salvav
		naufrago
		10 font blanco cr puntaje " %d" printc
|		fonti dup fx> fx - 6/ 2 >>  "%d %d" blanco print
		;

:fin
	inifx
	ini2d
	inikey
	'exit <esc>
	0 SPLAY
	show cls scr
		'efondo draw2d
		drawfx

		10 bfont sfill
		$ff0000 $00 gc.vdeg
		cr "Game Over" printc
		$ff00ff $00 gc.vdeg
		cr cr cr puntaje "You score: %d" printc
		blink 1? ( drop ; ) drop
		12 bfont 0 $ff gc.vdeg
		0 11 at "<ESC> Continue" printc
		;

:titulo
	inifx
	ini2d
	inigui
	[ exit 1 ; ] >esp<
	[ exit 0 ; ] <esc>
	show clrscr
		'efondo draw2d
		drawfx

		10 bfont sfill
		$ff0000 $00 gc.vdeg
		cr "Experimental Gameplay" printc
		cr "Proyect" printc
		$ff00ff $00 gc.vdeg
		cr cr "Minimun Gameplay" printc
		$ff00 $00 gc.vdeg
		cr cr "press <ESPACE> to" printc
		cr "drop life preserver" printc

		blink 1? ( drop ; ) drop
		12 bfont 0 $ff gc.vdeg
		0 11 at "<ESPACE> Play  <ESC> Quit" printc
		;

: 33
	loadsound
	( titulo 1? )( drop main fin )
	;


