| main.txt
| menu principal
| PHREDA 2009
|----------------------------------
^lib/reda4.txt
^lib/parse.txt
^lib/gui.txt
^lib/fontt.txt
^lib/fonth.txt
^lib/trace.txt

|--menu de arbol2
#nroh -1
#nrof -1

#lastrun )( 64

#menuprg
#menuprg>

:setnow | adr --
	0? ( drop ; ) "%a.txt" mprint
	dup 'lastrun strcpy
:loadsrc | name --
	here swap load 0 swap ! ;

:clickf | adr nro -- adr nro
	dup 'nrof !
	over setnow
	;

:clickn
	;
	-1 dup 'nroh ! 'nrof !
	;

:clickhi
	dup 'nroh !
	over fld# 1- 'nrof !
	>>f setnow
	;

|-------
:dominios | adr --
	reg#
	( 1? )( 1-
		nroh =? ( cyan )( negro )
        'clickhi pick2 " %a " allow2cr sp btnt
		swap >>fi swap ) 2drop ;

:programas | adr --
	reg# nroh - 1- ( 1? )( 1-	swap >>fi swap ) drop
    fld# ( swap >>f swap 1? )( 1-
		nrof =? ( verde )( negro )
		'clickf pick2 " %a " allow2cr sp btnt |cr cr2
		) 2drop
	;

|----------- estado
:grabaestado
	"./" dir
	'nroh 72 "nom/main.nom" save
	;

:restauraestado
	"./" dir
	'nroh "nom/main.nom" load drop
	'lastrun c@ 0? ( drop ; ) drop
	'lastrun loadsrc
	;

:loadmenu
	here dup 'menuprg !
	"mem/prg.txt" load
	dup 'menuprg> !
	0 swap !+ 'here ! ;

:+dom | dom --
	"%s~" mprint
	menuprg>
	( 1- dup c@ 0? )( drop 1- ) drop 1+
	|( 1- dup c@ $7e =? )( drop 1- ) drop 1+
	strcpyl 1- 'menuprg> !
:savemenu
	menuprg count "mem/prg.txt" save
	;

|--
:+list | "" lugar arbo --
	3drop
	;


|------------ para cada dominio
|-- sistema
:confsis
	grabaestado
	"config.txt" run ;

|-- programa
:preprg
	fonti home
	"Codigo" print cr
	blanco here text
	;

:runprg
	'lastrun c@ 0? ( drop ; ) drop
	grabaestado
	'lastrun run ;

:editprg
	'lastrun c@ 0? ( drop ; ) drop
	grabaestado
	'lastrun count
	"./nom/editor.nom" save
	"edit-code.txt" run ;

|--
:runtimeerr
	"runtime2.txt" run ;

:borractual
	;


#name )( 32

:agregap
	'name dup c@ 0? ( 2drop exit ; ) drop
	| agrega a lista
|	hojaact  menuprg +list
	drop
	exit ;

:newprg
	0 'name !
	inigui
	'exit >esc<
	show clrscr
		32 gc.top $f gc.hfill
		font-vard-12-bold home cr2
		verde dup " :R%d" print
		blanco " New File Name?" print
		32 26 gc.vbetween
		font-vard-12-bold home
		cr cr blanco
		" Enter Name " print
|        ramaact "in %a>>" print hojaact "%a" print cr cr
|        ramaact "in %a" print cr cr
		sp 'name 31 getline
		'agregap lostfoco
		bmouse 0? ( cflecha )( cmano ) drop	;
	;

:newdom
	'name c@ 0? ( drop ; ) drop
	'name +dom
	exit ;

:clicknew
	0 'name !
	inigui
	'exit >esc<
	show clrscr
		32 gc.top $f0f gc.hfill
		font-vard-12-bold home cr2
		verde dup " :R%d" print
		blanco " ROOT " print

		26 gc.botton $f0f gc.hfill
		font-vard-8-bold home cr2

	| acciones
		rojo
		sp 'exit "esc-Exit" btnt
|		sp verde
|		sp 'runprg "f1-Run" btnt
|		sp 'editprg "f2-Edit" btnt
|		sp 'newprg "f3-NewPrg" btnt
|		violeta sp 'adddome "+Fold" btnt
|		rojo sp 'borractual "Del" btnt

	| menu datos
		sp cyan
|		sp 'runtimeerr "f9-RUNERR" btnt
|		sp 'confsis "f10-CONFIG" btnt

		32 26 gc.vbetween
	| datos
		w 2 >> gc.left

		font-vard-12-bold
|		font-vard-8-bold
|		font-vard-8-out
		home
|		menuprg menutree cr2
		menuprg dominios cr cr

	| prevista
		sw dup 2 >> - gc.rigth

		home blanco

        "New Domain" print cr cr2
		'name 32 getline
		'newdom lostfoco
		cmano
	;


|---------- main
:main
	inigui
	'exit >esc<
	'runprg <f1>
	'editprg <f2>
|	'newprg <f3>

	'runtimeerr <f9>
	'confsis <f10>

	[ -1 'nrof +! ; ]  <dn>
	[ 1 'nrof +! ; ] <up>

	show clrscr
		32 gc.top $ccc gc.hfill
		font-vard-12-bold home cr2
		verde dup " :R%d" print
		blanco " MENU " print

		26 gc.botton $ccc gc.hfill
		font-vard-8-bold home cr2

	| acciones
		rojo
		sp 'exit "esc-Exit" btnt
		sp verde
		sp 'runprg "f1-Run" btnt
		sp 'editprg "f2-Edit" btnt
|		sp 'newprg "f3-NewPrg" btnt
|		violeta sp 'adddome "+Fold" btnt
|		rojo sp 'borractual "Del" btnt

	| menu datos
		sp cyan
		sp 'runtimeerr "f9-RUNERR" btnt
		sp 'confsis "f10-CONFIG" btnt

		32 26 gc.vbetween
	| datos
		font-vard-12-bold
		home cr2
		menuprg dominios
|		verde 'clicknew "* NEW *" sp btnt
		cr cr cr2
		menuprg programas
		bmouse 0? ( cflecha )( cmano ) drop	;


|****** BOOT ******
: 0 paper
	mark
	loadmenu
	restauraestado
	4 main
	grabaestado
	;
