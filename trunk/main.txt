| main.txt
| menu principal
| PHREDA 2009
|----------------------------------
^lib/reda4.txt
^lib/parse.txt
^lib/gui.txt
^lib/fontt.txt
|^lib/fonth.txt
^lib/trace.txt

|--menu de arbol2
#nroh
#nrof

#menuprg
#prgact


:cargasrc
	prgact 0? ( drop ; ) "%a.txt" mprint
	here swap load drop ;

:
:clickf
	dup 'nrof !
	over 'prgact !
	cargasrc
	;

:normal2
	'clickf onLineMove
	over "%a" negro printc cr
	;

:marcado2
	'clickf onLineMove
	over "%a" blanco printc cr
	;

:clickn
|	0 'nroh !
	;

:conhijos2
	azul
	over fld# 2 + linesfill drop
	cr2 'clickn pick2 "%a" cyan 14 btnm cr cr2
	over fld# ( swap >>f swap 1? )( 1-
		nrof =? ( marcado2 )( normal2 )
		) 2drop
	cr2
	;

:clickhi
	dup 'nroh ! 0 'nrof ! ;

:sinhijos2
	'clickhi onLineMove
|	over "%a" blanco print cr
	gris
	cr2 'clickhi pick2 "%a" 14 btnm cr cr2
	;

:menutree2 | adr --
	reg# ( 1? )( 1-
		nroh =? ( conhijos2 )( sinhijos2 )
		swap >>fi swap ) 2drop ;

|----------- estado
:grabaestado
	"./" dir
	'nroh 8 "nom/main.nom" save
	;

:restauraestado
	"./" dir
	'nroh "nom/main.nom" load drop

	menuprg
	reg# 1- nroh - ( 1? )( 1- swap >>fi swap ) drop
	fld# nrof - ( 1? )( 1- swap >>f swap ) drop
	'prgact !
	cargasrc
	;

:loadmenu
	here dup 'menuprg !
	"mem/prg.txt" load
	0 swap !+ 'here ! ;

:savemenu
	menuprg count "mem/prg.txt" save
	;


|------------ para cada dominio
|-- sistema
:confsis
	grabaestado
	"config.txt" run ;

:keysis
	grabaestado
	"scancode.txt" run ;

|-- programa
:preprg
	fonti home
	"Codigo" print cr
	blanco here text
	;

:runprg
	prgact 0? ( drop ; )
	grabaestado
	"%a.txt" mprint run ;

:editprg
	prgact 0? ( drop ; )
	grabaestado
	"%a.txt" mprint count
	"./nom/editor.nom" save
	"edit-code2.txt" run ;
|	"edit-code.txt" run ;

|--
:runtimeerr
	"runtime2.txt" run ;

:borractual
	;
:adddome
	;

|--
:+list | adnew lugar lista --
	3drop
	;

#name )( 32

:agregap
	'name dup c@ 0? ( 2drop exit ; ) drop
	| agrega a lista
|	hojaact  menuprg +list
	drop
	exit ;

:newprg
	0 'name !
	inigui
	'exit >esc<
	show clrscr
		32 gc.top $f gc.hfill
		font-vard-12-bold home cr2
		verde dup " :R%d" print
		blanco " New File Name?" print
		32 26 gc.vbetween
		font-vard-12-bold home
		cr cr blanco
		" Enter Name " print
|        ramaact "in %a>>" print hojaact "%a" print cr cr
|        ramaact "in %a" print cr cr
		sp 'name 31 getline
		'agregap lostfoco
		bmouse 0? ( cflecha )( cmano ) drop	;
	;


|---------- main
:main
	inigui
	'exit >esc<
	'runprg <f1>
	'editprg <f2>
	'newprg <f3>

	'runtimeerr <f9>
	'confsis <f10>
	'keysis <f11>

	[ -1 'nrof +! ; ]  <dn>
	[ 1 'nrof +! ; ] <up>

	show clrscr
		32 gc.top $f gc.hfill
		font-vard-12-bold home cr2
		verde dup " :R%d" print
		blanco " ROOT " print

		26 gc.botton $00000f gc.hfill
		font-vard-8-bold home cr2

	| acciones
		rojo
		sp 'exit "esc-Exit" btnt
		sp verde
		sp 'runprg "f1-Run" btnt
		sp 'editprg "f2-Edit" btnt
		sp 'newprg "f3-New" btnt
|		violeta sp 'adddome "+Fold" btnt
|		rojo sp 'borractual "Del" btnt

	| menu datos
		sp cyan
		sp 'runtimeerr "f9-RUNERR" btnt
		sp 'confsis "f10-CONFIG" btnt
		sp 'keysis "f11-KEY" btnt

		32 26 gc.vbetween
	| datos
		w 2 >> gc.left
|		font-vard-12-bold
		font-vard-8-bold
		home

|		menuprg menutree
		menuprg menutree2
	| prevista
		sw dup 2 >> - gc.rigth fonti home
|		nrof nroh "%d %d" print cr
		blanco here text
		bmouse 0? ( cflecha )( cmano ) drop	;


|****** BOOT ******
: 0 paper
	mark
	loadmenu
	restauraestado
	4 main
	grabaestado
	;
