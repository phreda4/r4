| Editor de Voxels
| PHREDA 2014
|-----------------------------
^r4/lib/gui.txt
^r4/lib/dlgfile.txt
^r4/lib/morton.txt

^r4/dev/octree/iso_5.txt

^r4/lib/trace.txt

#filename )( 1024

#octsize 0.05

#xcam 0 #ycam 0 #zcam 0.2
#rx #ry

|----------- graficacion
:3dop transform 3dproject op ;
:3dline transform 3dproject line ;

|---- dibujos de grillas
:drawboxz | z --
	octsize neg octsize neg pick2 3dop
	octsize octsize neg pick2 3dline
	octsize octsize pick2 3dline
	octsize neg octsize pick2 3dline
	octsize neg octsize neg rot 3dline ;

:drawboxy | y --
	octsize neg over octsize neg 3dop
	octsize over octsize neg 3dline
	octsize over octsize 3dline
	octsize neg over octsize 3dline
	octsize neg swap octsize neg 3dline ;

:drawboxx | x --
	dup octsize neg octsize neg 3dop
	dup octsize octsize neg 3dline
	dup octsize octsize 3dline
	dup octsize neg octsize 3dline
	octsize neg octsize neg 3dline ;

:drawlinez | x1 x2 --
	2dup octsize neg 3dop octsize 3dline ;

:draw3dbox
	$707070 neg ink
	octsize neg drawboxz
	octsize drawboxz
	octsize neg octsize neg drawlinez
	octsize octsize neg drawlinez
	octsize octsize drawlinez
	octsize neg octsize drawlinez ;

|------------- load octree
#vistaoctree

:loadoctree
	mark
	"media/3do" dlgfileload 0? ( drop empty ; )
	load3do 'vistaoctree !
	empty ;
	;

|------ vista
#xm #ym
:dnlook
	xymouse 'ym ! 'xm ! ;

:movelook
	xymouse
	ym over 'ym ! - 7 << 'rx +!
	xm over 'xm ! - neg 7 << neg 'ry +!  ;

|-----------------
#fps
#fpsc
#mseca

:main
	4
	show clrscr fonti verde
		dup ":r%d VoxelView  " print
		1 'fpsc +!
		msec dup mseca - fps "[fps:%d %dms]" print 'mseca !
		cr
		cr2
		'loadoctree dup <f1> "F1-Load" sp btnt cr
		cr2

		3dini
		rx mrotx ry mroty
		xcam ycam zcam mtrans
|		qsize 2/ neg dup dup mtransi

|		draw3dbox
		maskb.clear
		vistaoctree 1? ( drawoctree )( drop )

		'dnlook 'movelook guiDnMove

		[ -0.01 'zcam +! ; ] <up>
		[ 0.01 'zcam +! ; ] <dn>
		[ -0.01 'xcam +! ; ] <le>
		[ 0.01 'xcam +! ; ] <ri>
		[ -0.01 'ycam +! ; ] <pgup>
		[ 0.01 'ycam +! ; ] <pgdn>

		'exit >esc<
		cminiflecha
		1000 .mseg .restart
		fpsc 'fps ! 0 'fpsc !
		;

|--------------------------
:memory
	mark
	maskb.ini
	;

: memory main ;
