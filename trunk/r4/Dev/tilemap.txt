| tilemap
| PHREDA 2010
|--------------------------
^r4/lib/gui.txt
^r4/lib/btn.txt
^r4/lib/sprites.txt
^r4/lib/trace.txt

^inc/tilemap.bmr
^inc/tilemap.rmt
^inc/tilemap.vsp

#xini #yini #vx1 #vy1
|#s1 'dibu1
#accion
#tacc
#dir1 1
#tileaba

#tiles 0 'dibua 'dibuc 'dibu14 'dibu15 'dibu12 'dibu24 'dibu13  0 'dibu11

#pantalla (
7 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 7
7 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 7
7 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 7
7 0 0 7 7 7 7 7 7 7 7 0 0 0 0 0 0 0 0 7
7 0 0 3 0 0 0 0 0 0 3 0 0 0 0 0 0 0 0 7
7 0 0 3 0 0 0 0 0 0 3 0 0 0 0 0 0 0 0 7
7 0 0 3 0 0 0 0 0 0 3 0 0 0 0 0 0 0 0 7
7 0 0 3 0 0 0 0 0 0 3 0 0 0 0 0 0 0 0 7
7 0 0 3 0 0 0 0 0 0 3 0 0 0 0 0 0 0 2 7
7 0 0 3 0 0 0 0 0 0 7 7 9 9 9 9 9 7 7 7
7 0 0 3 0 0 0 0 0 0 7 7 7 7 7 7 7 7 7 7
7 1 0 3 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 7
7 7 7 7 7 7 0 0 0 0 0 0 0 0 0 0 0 0 0 7
7 0 3 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 7
7 0 3 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 7
7 0 3 0 0 0 0 0 0 7 7 7 0 0 0 0 0 0 0 7
7 0 3 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 7
7 0 3 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 7
7 0 3 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 2
7 7 7 7 7 7 9 9 9 9 9 9 9 9 7 7 7 7 7 7
)

#pantalla1 (
7 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 7
7 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 7
7 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 7
7 0 5 5 4 4 4 4 4 4 4 4 4 4 5 5 5 0 0 7
7 0 3 0 0 0 0 0 0 0 1 0 0 0 0 0 3 0 0 7
7 0 3 0 0 0 0 0 0 0 0 0 0 0 0 0 3 0 0 7
7 0 3 0 0 0 0 0 0 0 0 0 0 0 0 0 3 0 0 7
7 0 3 0 0 0 0 0 0 0 0 0 0 0 0 5 5 0 0 7
7 0 3 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 7
7 0 5 5 5 5 5 5 0 0 0 0 0 1 0 0 0 0 0 7
7 0 0 0 0 0 0 3 0 0 0 0 0 5 5 0 0 0 0 7
7 0 0 0 0 0 0 3 0 0 0 0 0 0 0 0 0 0 0 7
7 0 0 0 0 0 0 3 0 0 0 0 0 0 0 0 0 0 0 7
7 0 0 0 0 0 0 3 0 0 0 0 0 0 0 5 5 0 0 7
7 0 0 0 0 0 0 3 0 0 0 0 0 0 0 0 0 0 0 7
7 0 0 0 0 1 0 3 0 0 0 0 0 0 0 0 0 0 0 7
7 0 0 5 5 5 5 5 0 0 0 0 0 0 0 0 0 0 0 7
7 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 7
7 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 2 7
7 5 5 5 5 5 9 9 9 9 9 9 9 9 5 5 5 5 5 7
)


|---------------------------------------------------------

:gettile | x y -- t
	-? ( 2drop 0 ; ) 19 >? ( 2drop 6 ; )
	swap
	-? ( 2drop 6 ; ) 19 >? ( 2drop 6 ; )
	swap
	20 * + 'pantalla + c@ ;

:settile | c x y --
	-? ( 3drop ; ) 19 >? ( 3drop ; )
	swap
	-? ( 3drop ; ) 19 >? ( 3drop  ; )
	swap
	20 * + 'pantalla + c! ;

:tiledraw | x y --
	gettile
	2 << 'tiles  + @
	1? (
|		'dibu11 =? ( blink 1? ( nip 'dibu23 swap ) drop )
|		'dibua =? ( blink 1? ( nip 'dibub swap ) drop )
		nsprite )( drop ) ;

:tilemap
	0.1 dup fdim
	-4 ( 24 <? )(
		0 ( 23 <? )( | n n
		xini pick2 12 - 0.1 * +
		yini pick2 12 - 0.1 * + fpos
		2dup tiledraw
		1+ ) drop
	1+ ) drop ;


:main
|----:juego
	usogui
	show clrscr
		tilemap

		'exit >esc<
    	;

: 0 paper 4 main ;