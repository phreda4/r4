| octree search point
| PHREDA 2014
|----------------------

^r4/lib/gui.txt
^r4/lib/trace.txt

| mesa

#ocdeep 3
#ocdata
$ff	| nivel 0
$71f |%00011111	| nivel 1
$b2f |%00101111
$f4f |%01001111
$138f |%10001111
$1711 |%00010001
$1822 |%00100010
$1944 |%01000100
$1A88 |%10001000
$8f |%10001111 | nivel 2 ultimo nivel
$0f |%00001111
$0f |%00001111
$0f |%00001111
$88 |%10001000
$0f |%00001111 |.
$4f |%01001111
$0f |%00001111
$0f |%00001111
$44 |%01000100
$0f |%00001111 |.
$0f |%00001111
$4f |%01001111
$0f |%00001111
$44 |%01000100
$0f |%00001111 |.
$0f |%00001111
$0f |%00001111
$8f |%10001111
$88 |%10001000
$88 |%10001000 |.
$88 |%10001000
$44 |%01000100 |.
$44 |%01000100
$44 |%01000100 |.
$44 |%01000100
$88 |%10001000 |.
$88 |%10001000


|---------------------------------------

#tpopcnt4 (
    0 4 4 8 4 8 8 12 4 8 8 12 8 12 12 16
    4 8 8 12 8 12 12 16 8 12 12 16 12 16 16 20
    4 8 8 12 8 12 12 16 8 12 12 16 12 16 16 20
    8 12 12 16 12 16 16 20 12 16 16 20 16 20 20 24
    4 8 8 12 8 12 12 16 8 12 12 16 12 16 16 20
    8 12 12 16 12 16 16 20 12 16 16 20 16 20 20 24
    8 12 12 16 12 16 16 20 12 16 16 20 16 20 20 24
    12 16 16 20 16 20 20 24 16 20 20 24 20 24 24 28
    4 8 8 12 8 12 12 16 8 12 12 16 12 16 16 20
    8 12 12 16 12 16 16 20 12 16 16 20 16 20 20 24
    8 12 12 16 12 16 16 20 12 16 16 20 16 20 20 24
    12 16 16 20 16 20 20 24 16 20 20 24 20 24 24 28
    8 12 12 16 12 16 16 20 12 16 16 20 16 20 20 24
    12 16 16 20 16 20 20 24 16 20 20 24 20 24 24 28
    12 16 16 20 16 20 20 24 16 20 20 24 20 24 24 28
    16 20 20 24 20 24 24 28 20 24 24 28 24 28 28 32 )

:popcnt4 | nro -- cnt
	'tpopcnt4 + c@ ;

#tplace  $01 $02 $04 $08 $10 $20 $40 $80

:place | nro -- pl
	2 << 'tplace + @ ;

|--- 3D x y z . 10 bits
:p1x2 | x -- v
 	$3ff and
	dup 16 << xor $ff0000ff and
	dup 8 << xor  $0300f00f and
	dup 4 << xor  $030c30c3 and
	dup 2 << xor  $09249249 and ;

:morton3d | x y z -- Z
	p1x2 2* swap p1x2 or 2* swap p1x2 or ;


|----------------------------------

:esta | x y z --
	morton3d
	'ocdata >r

	r@+ over 6 >> $7 and place | busca value now
	2dup and 0? ( nip nip nip rdrop ; ) drop	| no hay nadie
	1- over and popcnt4 swap 6 >> $fffffffc and + r+

	r@+ over 3 >> $7 and place | busca value now
	2dup and 0? ( nip nip nip rdrop ; ) drop	| no hay nadie
	1- over and popcnt4 swap 6 >> $fffffffc and + r+

	r@+ over $7 and place | busca value now
	2dup and 0? ( nip nip nip rdrop ; ) drop	| no hay nadie
	1- over and popcnt4 swap 6 >> $fffffffc and + r+
	drop r>
	;

#z 0
:main
	show clrscr
		z "z:%d " print cr
		0 ( 8 <? )(
			"  " print
			0 ( 8 <? )(
				over over z esta 0? ( drop "  " )( 'ocdata - 2 >> "%d." ) print
				1+ ) drop
				cr
			1+ ) drop

		[ 1 'z +! ; ] <dn>
		[ -1 'z +! ; ] <up>

		'exit >esc<
		cminiflecha ;

: mark main ;

