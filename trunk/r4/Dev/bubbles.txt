| bubles
| PHREDA 2012

^r4/lib/gui.txt
^r4/lib/part8.txt
^r4/dev/simple.spr

#bubles 0 0

:resetgame
	'bubles p.clear
	;

|---------
:r.01 rand 0.01 mod ;
:r.1 rand 0.1 mod ;
:r.8 rand 0.8 mod ;

:bub | adr -- adr/adr 0 delete
|	'bubles collisionbox 1? ( 2drop crash ; )( drop ) | 'fire 'aliens collisionbox
|	'bubles 'collision pmapmap
 	>r
	r@+ dup abs
	0.99 >? ( r 4+ dup @ neg swap ! ) drop
	r@+ dup abs
	1.1 >? ( rdrop 3drop 0 ; )
	0.99 >? ( r 4+ dup @ neg swap ! ) drop
	fpos
	r@+ r 12 - +!
	r @ 0.001 - r ! | gravedad
	r@+ r 12 - +!
	rdrop
	0.08 dup fdim
	'coso1 nsprite
	;


:+buble
	'bub 'bubles p!+ >r
	r.8 r.8 r!+ r!+
	r.01 r.01 r!+ r> ! ;

:collision | p1 p2 -- p1 p2
  	over 4+ @
	over 4+ @ - dup *.
	pick2 8 + @
	pick2 8 + @ - dup *. +
	0.02 >? ( drop ; )
	"%f " print ;


:main
	resetgame
	show clrscr
		scr home blanco
		dup "%d " print

		'bubles p.draw
		'collision 'bubles p.map2
		'+buble <spc>
		'exit >esc< ;

:inicio
	mark
	1000 'bubles p.ini
	;

: inicio 33 main ;

