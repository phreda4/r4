| puntos en esfera
| PHREDA 2012
|------------------------
^r4/lib/gui.txt
^r4/lib/trace.txt


#xmin #ymin #xmax #ymax
#xsum #ysum
#xcam 0 #ycam 0 #zcam -10.0
#xr 0.20 #yr 0.25

:3dop project3d op ;
:3dline project3d line ;
:3dpline project3d pline ;

:ejes
	-5.0 0 0 3dop 5.0 0 0 3dline
	0 -5.0 0 3dop 0 5.0 0 3dline
	0 0 -5.0 3dop 0 0 5.0 3dline ;

:marcas
	-5.0 ( 5.0 <? )(
		dup 0.01 0 3dop dup -0.01 0 3dline
		0.01 over 0 3dop -0.01 over 0 3dline
		0 0.01 pick2 3dop 0 -0.01 pick2 3dline
		1.0 + ) drop ;

:grillaxy
	-5.0 ( 5.0 <=? )(
		dup -5.0 0 3dop dup 5.0 0 3dline
		-5.0 over 0 3dop 5.0 over 0 3dline
		1.0 + ) drop ;

:grillayz
	-5.0 ( 5.0 <=? )(
		0 over -5.0 3dop 0 over 5.0 3dline
		0 -5.0 pick2 3dop 0 5.0 pick2 3dline
		1.0 + ) drop ;

:grillaxz
	-5.0 ( 5.0 <=? )(
		dup 0 -5.0 3dop dup 0 5.0 3dline
		-5.0 0 pick2 3dop 5.0 0 pick2 3dline
		1.0 + ) drop ;

:teclado
	'exit >esc<
	[ 0.1 'ycam +! ; ] <up>
	[ -0.1 'ycam +! ; ] <dn>
	[ 0.1 'xcam +! ; ] <le>
	[ -0.1 'xcam +! ; ] <ri>
	[ 0.1 'zcam +! ; ] <pgdn>
	[ -0.1 'zcam +! ; ] <pgup>
	[ 0.01 'xr +! ; ] <spc>
	;

:freelook
	xymouse
	sh 2/ - 7 << swap
	sw 2/ - neg 7 << swap
	neg mrotx
	mroty ;

:drawp | x y z ---
	project3d |2dup op line ;
	-? ( 2drop ; ) sh >=? ( 2drop ; )
	swap -? ( 2drop ; ) sw >=? ( 2drop ; ) swap
	setxy
	ink@ px!+
	;

|-----------------
| rand en box
:rr
	rnd $1ffff and $ffff - ;

:drawpointrand
	2 rndseed
	0 ( 5000 <? )(
		rr rr rr drawp
		1+ ) drop
	;

|-----------------
| coordenadas esfericas
| x = sinUcosV
| y = sinUsinV
| z = cosU
:drawpoints
	0 ( 1.0 <? )(
		0 ( 0.5 <? )(
			over sincos | u v sinu cosu
			pick2 sincos | u v sinu cosu sinv cosv
			pick3 *. >r | u v sinu cosu sinv   r:x
			rot *. r>
			drawp
			0.02 + ) drop
		0.02 + ) drop
	;

|-----------------
|    Choose height u uniformly distributed in [-1,1].
|    Choose angle psi uniformly distributed on [0, 2*pi).
| r = sqrt(1-u^2).
| x = r * cos(psi).
| y = r * sin(psi).
:drawpointt
	-1.0 ( 1.0 <? )(
		0 ( 1.0 <? )(
			1 pick2 dup *. - sqrt.	| r
			over sincos				| r s c
			pick2 *. swap pick2 *.
			drawp
			0.05 + ) drop
		0.05 + ) drop
	;


:calc3d | u v --
	over sincos | u v sinu cosu
	pick2 sincos | u v sinu cosu sinv cosv
	pick3 *. >r | u v sinu cosu sinv   r:x
	rot *. r>
	drawp ;

:drawpoints2
	0 ( 1.0 <? )(
		0 ( 0.5 <? )(
			calc3d
			0.02 + ) drop
		0.02 + ) drop
	;

:drawpoints2
	32 ( 1? )( 1-
		32 ( 1? )( 1-
			over 11 <<
			over 11 <<
			calc3d 2drop
		) drop
	) drop ;


:main
	mark

	show clrscr
     	teclado
		omode
		freelook
		xcam ycam zcam mtrans
|		gris grillaxy grillayz grillaxz
		blanco
		azul
|		drawpointrand
		rojo
|		drawpointt
		verde
		drawpoints
		blanco
		1.0 1.0 1.0 mtransi
		drawpoints2
		cminiflecha ;

: main ;