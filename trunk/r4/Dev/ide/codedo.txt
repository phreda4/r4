| CODEdo (ide)
| PHREDA 2013
|----------------------
^r4/lib/gui.txt
^r4/lib/btn.txt
^r4/lib/input.txt

^inc/fntm/droidsans13.txt
^r4/lib/fontm.txt

^r4/lib/rfont.txt
^r4/lib/ricons.txt
^inc/ric/fontawesomewebfont.ric
^inc/rft/dejavusans.rft

^r4/dev/ide/tokenr4.txt
^r4/dev/ide/tokenprint.txt

#sizepad


#error
#ypad
#tokencursor>
#tokenrun>
#pad )( 2048	| texto
#pad> 'pad

#hist )( $ffff	| historia
#hist> 'hist

:resetpad
	sh 2/ |sizepad -
	'ypad ! ;

:addhist
	'pad count swap hist> strcat 'hist> +! ;

|-----------------------------------------------

:showtokens
	'tokencod ( tokencod> <? )( @+
		|allowcr
		tokenstr printx sp
		) drop
	;

|-----------------------------------------------
:seterror
	drop
	;

#ee
:compila
	'pad testtoken
	0? ( seterror ; )
	'ee !
	tokencod> 'tokencursor> !

	0 'pad !
	refreshfoco ;

:compila&run
	'pad compilatoken
	0? ( seterror ; )
	'ee !

	0 'pad !
	refreshfoco

	stackreset
	'tokencod exectoken
	padreset
	stacktotoken
	;

:anttoken
	-4 'tokencursor> +!
	;

:sigtoken
	4 'tokencursor> +
	;

:showglass
	ypad sw * 2 << framev +
	sw sh ypad - *
	( 1? )( 1- swap dup @ 2/
		$3f3f3f and
		$f or
		swap !+ swap )
	2drop ;

:editline
|	dejavusans 64 rfont!
	'fontdroidSans13 fontm
	'tokencod ( tokencursor> <? )( @+
|		tokencolor tokenstr allowcr printx sp
		tokencolor tokenstr allowcr 'exit swap sp flatbtn
		)
	blanco sp 'pad 2048 inword sp
	(  tokencod> <? )( @+
|		tokencolor tokenstr allowcr printx sp
		tokencolor tokenstr allowcr 'exit swap sp flatbtn
		) drop

	'pad c@ 1? ( drop ; ) drop | ****
	'anttoken  <le>
	'sigtoken <ri>
	;

:showpad
	showglass
	4 ypad atxy | imprime tira de tokens
	editline

	'compila <spc>
	'compila&run <enter>
	| del
	| left
	| rigth
	[ 4 'sizepad +! resetpad ; ] <f1>
	[ -4 'sizepad +! resetpad ; ] <f2>

	;

:msgerror
	error 0? ( drop ; ) print ;

:showhistoria
	blanco
	'hist print
	;

#sizei 16

:btnico
	sizei 2* 2 - qdim drawric sizei 2* qdim ;

:showbotones
	sw sizei 2 + - ypad sizei + pos
	sizei 2* qdim
	negro 'exit btne rojo 'i.off btnico gc<<
	negro 'exit btne cyan 'i.file btnico gc<<
	negro 'exit btne verde 'i.bolt btnico gc<<
	negro 'exit btne amarillo 'i.time btnico gc<<
	negro 'exit btne violeta 'i.trash btnico
	;

:fondo

	;

:panel
	rojo msgerror
|		amarillo dumptok cr
	verde dumpvstack
	verde dumpdic cr
|		showhistoria
	showpad
		showbotones
	;

:main
	tokencod> 'tokencursor> !
	4
	show clrscr
		fonti
		verde dup "r%d: " print cr
		panel
		'exit >esc<
		cminiflecha ;

:m
	mark
	80 'sizepad !
	resetpad
	0 paper
	'tokencod 'tokenrun> !
	;

: m main ;