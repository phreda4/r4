 | CODEdo (ide)
| PHREDA 2013
|----------------------
^r4/lib/gui.txt
^r4/lib/btn.txt
^r4/lib/input.txt
^r4/lib/codecolor.txt

^r4/lib/fontm.txt
^inc/fntm/droidsans13.txt
^r4/lib/ricons.txt
^inc/ric/fontawesomewebfont.ric

^r4/system/r4code.txt
^r4/system/anaword.txt

#ypad
#error
#tokencursor>
#tokenrun>

#pad )( 2048	| texto
#pad> 'pad

#hist )( $ffff	| historia
#hist> 'hist

|-----------------------------------------------
:addhist
	'pad count swap hist> strcat 'hist> +! ;

|-----------------------------------------------
:clearpad
	0 'pad ! refreshfoco ;

:seterror
	errormsg 'error !
	;

|----------------------------------
:helpmodo
	;

:memmapv
	d.TOS memmap
	;

#voc-system
"BYE" "HELP" "RESETVM" "MEMMAP"
( 0 )

#exe-system
'exit 'helpmodo 'resetvm 'memmapv
0

:nextw
    ( c@+ 32 >? )( drop )
	0? ( drop 1- )( drop )
	;

:pushnro | val --
	basen
	10 =? ( drop d.pushDec ; )
	2 =? ( drop d.pushBin ; )
	drop
	d.pushHex ;
	;

:palabraconsola | str -- str'
	( dup c@ 33 <? )( 0? ( nip ; ) drop 1+ )		| quitar espacios
|	$5e =? ( drop esinclude ; )			| $5e ^  Include
|	$7c =? ( drop escomentario ; )		| $7c |	 Comentario
|	$3A =? ( drop esdefinicion ; )		| $3a :  Definicion
|	$23 =? ( drop esvariable ; )		| $23 #  Variable

|	$22 =? ( drop escadena ; )			| $22 "	 Cadena

	$27 =? ( drop 1+ dup 				| $27 ' Direccion
		dup ?macro 1? ( 3drop "mACROnOTdIR" mensaje! 0 ; ) drop
		?palabra 1? ( nip stepadr nextw ; ) 2drop
		"NOTdIR" seterror 3 - 0 ; )
	drop
	dup ?numero 1? ( drop pushnro nip ; ) drop
	dup ?fnumero 1? ( drop d.pushFix nip ; ) drop
	dup 'voc-system inupp? 1? ( 1- 2 << 'exe-system + @ exec nextw ; ) drop
	dup ?macro 1? ( stepmacro nextw ; ) drop
	dup ?palabra 1? ( stepword nextw ; ) drop
	2drop 0
	"NOTfOUND" mensaje! ;

:correconsola
	'consola ( palabraconsola 0? ) drop
	0 'consola !
	;

:showglass
	ypad sw * 2 << framev +
	sw sh ypad - *
	( 1? )( 1- swap dup @ 2/
		$3f3f3f and
		$3f or
		swap !+ swap )
	2drop ;

:msgerror
	error 0? ( drop verde "Ok." print ; )
	rojo print ;

:showpad
	showglass
	'fontdroidsans13
	fontm

	4 ypad atxy
	msgerror cr
	blanco sp 'pad 2048 inword
	'compila&run <enter>
	;

:showhistoria
	blanco
	'hist print
	;

#sizei 16

:btnico
	sizei 2* 2 - qdim drawric sizei 2* qdim ;

:showbotones
	sw sizei 2 + - ypad sizei + pos
	sizei 2* qdim
	negro 'exit btne rojo 'i.off btnico gc<<
	negro 'exit btne cyan 'i.file btnico gc<<
	negro 'exit btne verde 'i.bolt btnico gc<<
	negro 'exit btne amarillo 'i.time btnico gc<<
	negro 'exit btne violeta 'i.trash btnico
	;


:panel
|		amarillo dumptok cr
	verde dumpvstack
	verde dumpdic cr
|		showhistoria
	showpad
|		showbotones
	;

:main
	tokencod> 'tokencursor> !
	4
	show clrscr
		fonti
		verde dup "r%d: " print cr
		panel
		'exit >esc<
		cminiflecha ;

:m
	0 paper
	mark
	sh 2/ dup 2/ + 'ypad !
	'tokencod 'tokenrun> !
	startvm
	;

: m main ;