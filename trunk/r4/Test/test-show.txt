| test de velocidad de video
| MCORNES/PHREDA - 2009
|-----------------------------------
^r4/lib/gui.txt
^inc/escena.inc

| tabla
| 'd lt x y s r
| dibujo tiempodevida x y tamanio rotacion
#spr1
	'dib13 0 0.0 0.0 0.3 0.0
	'dib13 0.2 0.0 0.0 0.2 0.0
	0
	)( 8192

#spr1> 'spr1

:draw1part | dir spr -- dir+
	swap >r
	| calculo aqui
	r @ 1+
	dup 7 << sincos 2 >> r 4+ ! 2 >> r 8 + !	| movimiento en circulo
	0.01 r 16 + +!
	r!+
	r@+ r@+ fpos
	r@+ dup fdim
	r@+ rnsprite
	r> ;

:drawpart | tabla --
	( @+ 1? )( draw1part ) 2drop ;

:+part
	spr1> 'spr1 6 move
	rand $fffff and spr1> 4+ !
	rand $7fff and spr1> 16 + !
	24 'spr1> +!
	0 spr1> ! ;

:-part
	-24 'spr1> +!
	0 spr1> ! ;

|-----------------
#lastime
#startime

#sle 1
:showtest
	0 '.exit !
	( .exit 0? )( drop
		sle update drop
		r exec
		redraw )
	drop rdrop 0 '.exit ! 0 key! ;

#frame
#frametic
#cont

:testshow
	mark
	here 'spr1> !
	+part
	0 'frame !
	0 'frametic !
	usogui
	msec 'cont !
	showtest clrscr

		here drawpart

		frame "fps: %d" print cr
		msec
		dup cont -
		30 <? ( 1 'sle +! ) 30 >? ( sle 1? ( 1- ) 'sle ! )
		"dif: %d" print cr
		sle "sleep:%d" print cr
		dup 'cont !
		startime - 1000 >? ( frametic 'frame ! 0 'frametic ! msec 'startime ! ) drop
		1 'frametic +!

		0 rows 1- gotoxy
		spr1> here - 24 / " %d sprites | <UP> 1+  <DN> 1- <ESC> Exit" print

		'exit >esc<
		'+part <up>
		'-part <dn>
		cflecha
		;


: testshow ;
