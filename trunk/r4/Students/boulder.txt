^r4/lib/trace.txt
^r4/lib/gui.txt
^r4/lib/sprite.txt

#:hormiga  $7D531 $E32FD302 $DA1039B4 $D6548482 $198F7F4 $1A30AF42 $1F8857A4 $2123EAA2 $7D539
 $A60000D $FAAFD331 $FAAF8423 $6F78423 $4D3D553 $FAAFD33A $A60000D $2233931 $FAAECC32
 $F1934EA4 $F5DF9522 $1139B94 $88FA642 $111B5FB4 $A2AC182 $2233939 $A60000D $C64502A1
 $D8704683 $D53C4453 $C310F3A3 $C64502AA $FF0000D $289C77B1 $209848B1 $32C506F3 $35F8FC43
 $234448B3 $289C77BA $FF0000D $23CFFFD1 $323CA8C3 $35709E13 $278FFFD3 $23CFFFDA $FF0000D
 $D5440AB1 $C3A0B5B3 $C3A09383 $D0740893 $D5440ABA $FF0000D $D20FFBC1 $D20C0883 $E65C0883
 $E65FFBC3 $D20FFBCA $FF0000D $191FF331 $191C0223 $25680223 $256BF333 $191FF33A $FF0000D
 $66BB531 $66BC433 $19A7C433 $19A7B533 $66BB53A $FF0000D $F913B751 $F913C423 $E6E7C423
 $E6E7B753 $F913B75A $FF0000D $14D7B761 $278F23D3 $2BD32A43 $1787BFE3 $14D7B76A $FF0000D
 $D8772601 $E4C3C203 $E7FBBFD3 $DCBF1F83 $D877260A $FF0000D 0

#:diamante  $84400281 $BF580221 $10083 $40200443 $FE6B03C3 $BF58022A $3F5489E7 $C6B31798 $FFFFFFC
 $400FFE 0

#:pasto  $BFEB02F1 $C0510063 $40810203 $3FB30143 $BFEB02FA $10103D $DB0491 $DB3FC3 $3E133FC3
 $3E130493 $DB049A $1F772227 $F7CEDD28 $41A600C $64FF00E $C18F0301 $C18F3FC3 $FF333E23
 $FF9B0633 $C18F030A $E29F1B57 $B0B6D4E8 $41A600C $64FF00E $E05B44B1 $E05B8323 $1CC38183
 $1D2F4303 $E05B44BA $FF9764B7 $CF1F1848 $41A600C $64FF00E $C0BF8661 $C18FBFF3 $FECBC193
 $FECB8663 $C0BF866A $E097A3F7 $B81B4998 $41A600C $64FF00E $FF3384C1 $6BC193 $3F47BFF3
 $3F478813 $FF3384CA $203FA407 $F3B356C8 $41A600C $64FF00E $E137C681 $E1340013 $1CC40013
 $1CC7C683 $E137C68A $FEFFE347 $CDE39BC8 $41A600C $64FF00E $C18C04E1 $C1F43E73 $FE5841B3
 $FE580683 $C18C04EA $E05C2417 $B5A3CEC8 $41A600C $64FF00E $3DA04EE1 $FEC804E1 $FF303E73
 $3F443E73 $3E740693 $FEC804EA $1FD821B7 $F483C828 $41A600C $64FF00E $E19C46A1 $E19881D3
 $1E688033 $1E6846A3 $E19C46AA $6367 $DD7C2918 $41A600C $64FF00E $FF988371 $BEA3
 $3EDCBD03 $3EDC8523 $FF98837A $2078A2A7 $F6244508 $41A600C $64FF00E $C1F886C1 $C1F8C393
 $FF2CC393 $FF2C86C3 $C1F886CA $E8949A87 $C1F94078 $41A600C $64FF00E $E204C6E1 $E26CFEC3
 $1ED0FEC3 $1E68C393 $E204C6EA $170E547 $DB70BB68 $41A600C $64FF00E $1D974301 $1D978183
 $401B8323 $3F474303 $1D97430A $2F0B6317 $197B3928 $41A600C $64FF00E $C0BF44A1 $C1278323
 $DEBB8323 $DEBB44A3 $C0BF44AA $CFBB6317 $9C2B1EE8 $41A600C $64FF00E $1E6BC681 $1E6BFE63
 $40800013 $3FB3C4E3 $1E6BC68A $3013E357 $ECBA408 $41A600C $64FF00E $C0BFC4E1 $BF1801A3
 $DF2401A3 $DF8FC683 $C0BFC4EA $CF1FE5B7 $BF180008 $41A600C $64FF00E $1FA04361 $1FA07E83
 $40148023 $3FB04503 $1FA0436A $30406367 $19E02918 $41A600C $64FF00E $C0B84501 $C05081D3
 $E1988373 $E0C84503 $C0B8450A $D0C060F7 $AF7BEFA8 $41A600C $64FF00E $2074C391 $2074FB73
 $3FB0FD13 $4018C1F3 $2074C39A $307CDF87 $176CA948 $41A600C $64FF00E $BFE8C6E1 $BFE8FEC3
 $E204FEC3 $E0C8C6E3 $BFE8C6EA $D08CE2D7 $BFE88048 $41A600C $64FF00E 0

#:roca  $8B1701 $BA0305F2 $C4B00224 $CDC4CB12 $3BCED44 $3D74F5D2 $39BBF784 $44F33932 $8B1709
 $180CA6B7 $E3B35B78 $190302C $84450CE $DC376EA1 $D0FF6EA2 $CF639964 $D0FFC862 $DC37C864
 $E773C862 $E65F9FD4 $EA1F6A52 $DC376EA9 $DD4BD317 $C5C79968 $170B01C $8A490CE $4D31711
 $F2AB1712 $F0874EA4 $F1979312 $4D38EC4 $19ABA422 $16FF52E4 $16FF1712 $4D31719 $11A7A4B7
 $F66B4AF8 $1B0208C $63370CE $29B3C881 $1D67BFF2 $1D67EEE4 $1D641DF2 $29281DF4 $34E81DF2
 $381FECC4 $34EBBFF2 $29B3C889 $296C1017 $17CBC998 $140402C $81370CE $9144F21 $F7744F22
 $FC448F34 $F774CF62 $914CF64 $1AB8CF62 $180C9164 $1EFC5132 $9144F29 $C90BCB7 $F21C5C88
 $160000C $81370CE $D4303781 $C9803782 $CF6079D4 $D294AF42 $E078AD14 $EB28A8D2 $E4386474
 $DEE03782 $D4303789 $E65C7F27 $D6542898 $160000C $81370CE $F7FFC431 $EA1BC432 $EA1BECD4
 $EA181562 $F7FC1564 $5E01562 $5E3ECD4 $5E3C432 $F7FFC439 $4681017 $EF97D338 $170B01C
 $8A490CE 0

#:puerta  $BFEB0141 $C0510063 $40190063 $408302F3 $BFEB014A $CFB950D $C88B2711 $C7B90063 $CF850063
 $CF8728B3 $C88B271A $D75001A7 $C7B401A8 $FFFFFFC $CA9140E $31BB2DA1 $314CFEC3 $39F10063
 $39872A63 $31BB2DAA $2B8C09D7 $398409D8 $FFFFFFC $CA9140E $C5AB3291 $C5434E83 $3AC34E83
 $3B2B35E3 $C5AB329A $13B5A07 $13B28B8 $FFFFFFC $CA9140E $CF1F4E81 $CF850063 $FF98FEC3
 $34CE3 $CF1F4E8A $FEC832F7 $AFE3A258 $FFFFFFC $465145E $FECB4CE1 $FEC3 $30E4FEC3
 $314F4CE3 $FECB4CEA $27401A7 $3B2BDA48 $FFFFFFC $535747E $34BFB21 $3480343 $89C0343
 $89FFB23 $34BFB2A $62441CD $F7CC01A1 $F7CFFB23 $FD8FFB23 $FD8C0003 $F7CC01AA $62441CD
 0

#:pared  $BFEB02F1 $C0510063 $40810203 $3FB30143 $BFEB02FA $10103D $DB0491 $DB3FC3 $3E133FC3
 $3E130493 $DB049A $1F772227 $486FAB8 $FB885BC $5B3227F $C18F0301 $C18F3FC3 $FF333E23
 $FF9B0633 $C18F030A $DFC31D47 $C0BEFE08 $FB885BC $5B3227F $E05B44B1 $E05B8323 $1CC38183
 $1D2F4303 $E05B44BA $FF9764B7 $E19B47F8 $FB885BC $5B3227F $C0BF8661 $C18FBFF3 $FECBC193
 $FECB8663 $C0BF866A $E097A3F7 $C46F75F8 $FB885BC $5B3227F $FF3384C1 $6BC193 $3F47BFF3
 $3F478813 $FF3384CA $203FA407 $41B8668 $FB885BC $5B3227F $E137C681 $E1340013 $1CC40013
 $1CC7C683 $E137C68A $FEFFE347 $DB73BB08 $FB885BC $5B3227F $C18C04E1 $C1F43E73 $FE5841B3
 $FE580683 $C18C04EA $E05C2417 $C2CBEFA8 $FB885BC $5B3227F $3DA04EE1 $FEC804E1 $FF303E73
 $3F443E73 $3E740693 $FEC804EA $1FD821B7 $1A7EDF8 $FB885BC $5B3227F $E19C46A1 $E19881D3
 $1E688033 $1E6846A3 $E19C46AA $6367 $E34037E8 $FB885BC $5B3227F $FF988371 $BEA3
 $3EDCBD03 $3EDC8523 $FF98837A $2078A2A7 $20C6788 $FB885BC $5B3227F $C1288521 $C128C1F3
 $FE5CC1F3 $FE5C8523 $C128852A $DF90AAF7 $C9C8F1A8 $FB885BC $5B3227F $E204C6E1 $E26CFEC3
 $1ED0FEC3 $1E68C393 $E204C6EA $170E547 $E5B4CD78 $FB885BC $5B3227F $1D974301 $1D978183
 $401B8323 $3F474303 $1D97430A $2F0B6317 $1C5B4998 $FB885BC $5B3227F $C0BF44A1 $C1278323
 $DEBB8323 $DEBB44A3 $C0BF44AA $CFBB6317 $B9BF5378 $FB885BC $5B3227F $1E6BC681 $1E6BFE63
 $40800013 $3FB3C4E3 $1E6BC68A $3013E357 $1D97C9D8 $FB885BC $5B3227F $C0BFC4E1 $C18FFB23
 $DF2401A3 $DF8FC683 $C0BFC4EA $CF1FE5B7 $BF180008 $FB885BC $5B3227F $1FA04361 $1FA07E83
 $40148023 $3FB04503 $1FA0436A $30406367 $200C3E78 $FB885BC $5B3227F $C0B84501 $C05081D3
 $E1988373 $E0C84503 $C0B8450A $D0C060F7 $C05032F8 $FB885BC $5B3227F $2074C391 $2074FB73
 $3FB0FD13 $4018C1F3 $2074C39A $30E4DDE7 $1F38C048 $FB885BC $5B3227F $BFE8C6E1 $BFE8FEC3
 $E204FEC3 $E0C8C6E3 $BFE8C6EA $D0C0E477 $C2C8E2D8 $FB885BC $5B3227F 0

#dibujos 0 'hormiga 'diamante 'pasto 'roca 'puerta 'pared

#cantidad 0

#mapa
6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 
6 1 3 3 3 2 3 3 3 3 4 6 3 2 3 6 
6 3 3 3 3 3 3 3 3 3 3 6 3 3 3 6 
6 3 3 3 3 3 3 3 3 3 3 3 3 3 3 6 
6 3 3 3 3 2 3 3 4 3 3 6 3 3 3 6 
6 3 3 3 4 3 3 3 3 3 3 6 3 3 3 6 
6 3 2 3 3 3 4 3 3 3 3 6 6 6 2 6 
6 3 3 3 3 3 3 3 3 3 3 3 3 3 4 6 
6 3 3 3 3 3 3 3 3 2 3 3 3 3 3 6 
6 3 3 4 3 3 3 3 3 3 4 3 3 3 3 6 
6 4 3 3 4 3 3 3 3 3 3 3 3 3 2 6 
6 3 2 3 3 3 3 3 3 3 2 3 3 3 4 6 
6 3 3 3 2 3 3 3 3 3 3 3 3 3 3 6 
6 3 3 3 3 3 3 3 3 3 3 3 3 3 3 6 
6 3 3 3 3 3 3 4 3 3 3 3 3 3 3 6 
6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 

#x 1 | inicio
#y 1 | inicio

#aux 1
#aux2 0

:putmapa | valor x y
  16 * + 2 << 'mapa + ! ;


:getmapa | x y -- que?
	16 * + 2 << 'mapa + @ ;
 
:drawmapa
'mapa >r
	mpush
	-8.5 -7.5 0 mtransi
	-8.0 ( 8.0 <? )(
		-8.0 ( 8.0 <? )(
			 1.0 0.0 0.0 mtransi
			r@+
			mpush
|			dup 2 >> mrotxi
|    		0.23 pinpon over + mrotxi
			$f and
			1? ( 2 << 'dibujos + @ 3dnsprite )( drop )
			mpop
			1.0 + ) drop
		-16.0 1.0 0.0 mtransi
		1.0 + ) drop
	mpop rdrop ;


|:tocadiamante
|cantidad 1 + 'cantidad !+
|		 	cantidad 10 =? |fin del juego
|              (  
|                 5 14 14 putmapa   
|			   )
|;


|:caeroca
|exit
|x y 1 + 
|getmapa 0 =? ( 0 x y putmapa 4 x y 1 + putmapa ) 
| drop  
          

|;


:movderecha
  |x 1 + y -1 + 
  |getmapa 4 =? ( 
  |				drop 
  |				0 x y putmapa
		|		1 'x +!
  |              4 x y putmapa
   |             0 x y -1 + putmapa 
				|home "HAS MUERTO" print cr ; )
  
  |MUEVE ROCA
|  x y -1 + 
|  getmapa 4 =? ( 4 x y putmapa )     	




  x 1 +  y
  getmapa  4 =? ( drop ; )
    6 =? ( drop ; )
    5 =? ( exit ; ) 
    2 =? ( cantidad 1 + 'cantidad !+
		 	cantidad 10 =? |fin del juego
               (  
                 5 14 14 putmapa drop
			   )
 
			 )
    
 
    x y -1 + 
    |getmapa 4 =? ( 4 x y putmapa 0 x y -1 + putmapa )(  0 x y putmapa )    	
     getmapa 4 =? ( 4 x y putmapa 0 x y -1 + putmapa )(  0 x y putmapa )    	
    |getmapa 4 =? ( 1 'aux !+ -1 'aux2 !+
    |              (  drop x y aux + getmapa  3 =? )( drop 4 x aux + y putmapa 0 x y aux2 + putmapa 
    |                 aux 1 + 'aux !+ aux2 -1 + 'aux2 !+ drop ) 	
	|			)(  0 x y putmapa )
    |0 x y putmapa
    1 'x +! 
    1 x y putmapa
    


    
    | x y 1 + 
    |getmapa 0 =? ( 0 x y putmapa 4 x y 1 + putmapa ) 
    |drop 
        
;

:movizquierda
  x -1 +  y
  getmapa  4 =? ( drop ; )
    6 =? ( drop ; )
	5 =? ( exit ; )  
    2 =? ( cantidad 1 + 'cantidad !+ 
			cantidad 10 =? |fin del juego
               (  
                 5 14 14 putmapa  drop  
			   )
  		 )

 
    x y -1 + 
    getmapa 4 =? ( 4 x y putmapa 0 x y -1 + putmapa )(  0 x y putmapa )    	

    |0 x y putmapa
    -1 'x +! 
    1 x y putmapa     
;

:movarriba
  x y -1 +
  getmapa  4 =? ( drop ; )
    6 =? ( drop ; )
	5 =? ( exit ; )  
    2 =? ( cantidad 1 + 'cantidad !+ 
		cantidad 10 =? |fin del juego
               (  
                 5 14 14 putmapa drop   
			   )
		 )

    
    0 x y putmapa
    -1 'y +! 
    1 x y putmapa     
;

:movabajo
  
  |APLASTA                
  x y -1 + 
  getmapa 4 =? ( 
  				drop 
  				4 x y putmapa
				|1 'x +!
                |4 x y putmapa
                0 x y -2 + putmapa
  	            exit ; ) 
				|home "HAS MUERTO" print cr ; )
 

  
 
  x y 1 +
  getmapa  4 =? ( drop ; )
    6 =? ( drop ; )
    2 =? ( cantidad 1 + 'cantidad !+ 
			cantidad 10 =? |fin del juego
               (  
                 drop 5 14 14 putmapa 
			   )
		
		 ) 
   5 =? ( exit ; ) 
    drop
    0 x y putmapa
    1 'y +! 
    1 x y putmapa     
;



:teclado
	'movderecha <ri>
	'movizquierda <le>
    'movarriba <up>
    'movabajo <dn>
	;

	

:main
   inigui
   'exit >esc<
   teclado |movimiento de teclado
   show clrscr
        home x y cantidad "%d %d %d" print cr
   		1.0 3dmode
 		0 0 18.0 mtrans 
             
	   drawmapa
       
   ;


: main 33 ;
